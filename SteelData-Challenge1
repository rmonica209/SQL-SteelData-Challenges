/* steeldata.org.uk SQL Challenge 1 */

Cars Table
car_id INT PRIMARY KEY,
make VARCHAR(50),
type VARCHAR(50),
style VARCHAR(50),
cost_$ INT

Sales Table
sale_id INT PRIMARY KEY,
car_id INT,
salesman_id INT,
purchase_date DATE,
FOREIGN KEY (car_id) REFERENCES cars(car_id),
FOREIGN KEY (salesman_id) REFERENCES salespersons(salesman_id)

Salespersons Table
salesman_id INT PRIMARY KEY,
name VARCHAR(50),
age INT,
city VARCHAR(50)


/*1. What are the details of all cars purchased in the year 2022?*/
SELECT *, YEAR(sales.purchase_date) AS purchase_year
FROM cars
INNER JOIN sales
ON cars.car_id = sales.car_id
WHERE YEAR(sales.purchase_date) = 2022;


/*2. What is the total number of cars sold by each salesperson?*/
SELECT name, COUNT(car_id) AS cars_per_salesperson
FROM salespersons
INNER JOIN sales
ON salespersons.salesman_id = sales.salesman_id
GROUP BY name;

/* 3. What is the total revenue generated by each salesperson?*/
SELECT name, SUM(cost_$) AS revenue
FROM salespersons
INNER JOIN cars
ON salespersons.salesman_id = cars.car_id 

/*4. What are the details of the cars sold by each salesperson?*/
SELECT name, make, type, style, cost_$
FROM cars
INNER JOIN salespersons
ON cars.car_id = salespersons.salesman_id;

/*5. What is the total revenue generated by each car type?*/
SELECT type, SUM(cost_$) as total_revenue
FROM cars
INNER JOIN sales
ON cars.car_id = sales.car_id
GROUP BY type;

/*6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?*/
SELECT name, purchase_date, make, type, style, cost_$
FROM sales
INNER JOIN salespersons
ON sales.salesman_id = salespersons.salesman_id
INNER JOIN cars
ON cars.car_id = sales.car_id
WHERE name = 'Emily Wong' AND YEAR(sales.purchase_date) = 2021;

/*7. What is the total revenue generated by the sales of hatchback cars? */
SELECT style, SUM(cost_$) AS total_revenue
FROM cars
INNER JOIN sales
ON cars.car_id = sales.car_id
WHERE style = 'Hatchback';

/*8. What is the total revenue generated by the sales of SUV cars in the year 2022?*/
SELECT style, SUM(cars.cost_$) AS total_revenue
FROM cars
INNER JOIN sales
ON cars.car_id = sales.car_id
WHERE style = 'SUV' AND YEAR(sales.purchase_date) = 2022;

/*9. What is the name and city of the salesperson who sold the most number of cars in the year 2023?*/
SELECT name, city, SUM(sale_id) AS total_sales
FROM salespersons
INNER JOIN sales
ON salespersons.salesman_id = sales.salesman_id
WHERE YEAR(sales.purchase_date) = 2023
GROUP BY salespersons.salesman_id ASC
LIMIT 1;

/*10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?*/
SELECT name, age, SUM(cost_$)
FROM salespersons
INNER JOIN sales
ON salespersons.salesman_id = sales.salesman_id
INNER JOIN cars
ON sales.car_id = cars.car_id
WHERE YEAR(sales.purchase_date) = 2022
GROUP BY salespersons.salesman_id ASC
LIMIT 1;

