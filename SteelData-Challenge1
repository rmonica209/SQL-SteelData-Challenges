/* steeldata.org.uk SQL Challenge 1 */

Cars Table
car_id	make	     type	      style	    cost_$
1	      Honda	      Civic	    Sedan	    30000
2	      Toyota	    Corolla	  Hatchback	25000
3	      Ford	      Explorer	SUV	      40000
4	      Chevrolet	  Camaro	  Coupe	    36000
5	      BMW	         X5	      SUV	      55000
6	      Audi	       A4	      Sedan	    48000
7	      Mercedes	  C-Class	  Coupe	    60000
8	      Nissan	    Altima	  Sedan	2    6000

Sales Table
sale_id	car_id	salesman_id	purchase_date
1	       1	        1	       2021-01-01
2	       3	        3	       2021-02-03
3	       2	        2	        2021-02-10
4	       5	        4	        2021-03-01
5	       8	        1	        2021-04-02
6	       2	        1	        2021-05-05
7	       4	        2	        2021-06-07
8	       5	        3	        2021-07-09
9        2	        4	        2022-01-01
10	     1	        3	        2022-02-03
11	     8	        2	        2022-02-10
12	     7	        2	        2022-03-01
13	     5	        3	        2022-04-02
14	     3	        1	        2022-05-05
15	     5	        4	        2022-06-07
16	     1	        2	        2022-07-09
17	     2	        3	        2023-01-01
18	     6	        3	        2023-02-03
19	     7	        1	        2023-02-10
20	     4	        4	        2023-03-01

Salespersons Table
salesman_id	 name	      age	 city
1	         John Smith	  28	 New York
2	         Emily Wong	  35	 San Fran
3	         Tom Lee      42	 Seattle
4	         Lucy Chen	  31	 LA


/*1. What are the details of all cars purchased in the year 2022?*/
SELECT *, YEAR(sales.purchase_date) AS purchase_year
FROM cars
INNER JOIN sales
ON cars.car_id = sales.car_id
WHERE YEAR(sales.purchase_date) = 2022;


/*2. What is the total number of cars sold by each salesperson?*/
SELECT name, COUNT(car_id) AS cars_per_salesperson
FROM salespersons
INNER JOIN sales
ON salespersons.salesman_id = sales.salesman_id
GROUP BY name;

/* 3. What is the total revenue generated by each salesperson?*/
SELECT name, SUM(cost_$) AS revenue
FROM salespersons
INNER JOIN cars
ON salespersons.salesman_id = cars.car_id 

/*4. What are the details of the cars sold by each salesperson?*/
SELECT name, make, type, style, cost_$
FROM cars
INNER JOIN salespersons
ON cars.car_id = salespersons.salesman_id;

/*5. What is the total revenue generated by each car type?*/
SELECT type, SUM(cost_$) as total_revenue
FROM cars
INNER JOIN sales
ON cars.car_id = sales.car_id
GROUP BY type;

/*6. What are the details of the cars sold in the year 2021 by salesperson 'Emily Wong'?*/
SELECT name, purchase_date, make, type, style, cost_$
FROM sales
INNER JOIN salespersons
ON sales.salesman_id = salespersons.salesman_id
INNER JOIN cars
ON cars.car_id = sales.car_id
WHERE name = 'Emily Wong' AND YEAR(sales.purchase_date) = 2021;

/*7. What is the total revenue generated by the sales of hatchback cars? */
SELECT style, SUM(cost_$) AS total_revenue
FROM cars
INNER JOIN sales
ON cars.car_id = sales.car_id
WHERE style = 'Hatchback';

/*8. What is the total revenue generated by the sales of SUV cars in the year 2022?*/
SELECT style, SUM(cars.cost_$) AS total_revenue
FROM cars
INNER JOIN sales
ON cars.car_id = sales.car_id
WHERE style = 'SUV' AND YEAR(sales.purchase_date) = 2022;

/*9. What is the name and city of the salesperson who sold the most number of cars in the year 2023?*/
SELECT name, city, SUM(sale_id) AS total_sales
FROM salespersons
INNER JOIN sales
ON salespersons.salesman_id = sales.salesman_id
WHERE YEAR(sales.purchase_date) = 2023
GROUP BY salespersons.salesman_id ASC
LIMIT 1;

/*10. What is the name and age of the salesperson who generated the highest revenue in the year 2022?*/
SELECT name, age, SUM(cost_$)
FROM salespersons
INNER JOIN sales
ON salespersons.salesman_id = sales.salesman_id
INNER JOIN cars
ON sales.car_id = cars.car_id
WHERE YEAR(sales.purchase_date) = 2022
GROUP BY salespersons.salesman_id ASC
LIMIT 1;

