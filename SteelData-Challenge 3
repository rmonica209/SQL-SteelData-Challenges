/* steeldata.org.uk SQL Challenge 3 */

/* TABLE country (
country_id INT PRIMARY KEY,
country_name VARCHAR(50),
head_office VARCHAR(50)
);
--------------------
 TABLE customers (
customer_id INT PRIMARY KEY,
first_shop DATE,
age INT,
rewards VARCHAR(50),
can_email VARCHAR(50)
);
--------------------
 TABLE orders (
order_id INT PRIMARY KEY,
customer_id INT,
date_shop DATE,
sales_channel VARCHAR(50),
country_id INT,
FOREIGN KEY (customer_id) REFERENCES customers(customer_id),
FOREIGN KEY (country_id) REFERENCES country(country_id)
);
--------------------
 TABLE products (
product_id INT PRIMARY KEY,
category VARCHAR(50),
price NUMERIC(5,2)
);
--------------------
 TABLE baskets (
order_id INT,
product_id INT,
FOREIGN KEY (order_id) REFERENCES orders(order_id),
FOREIGN KEY (product_id) REFERENCES products(product_id)
);  */


/*1. What are the names of all the countries in the country table?*/
SELECT country_name
FROM country;

/*2. What is the total number of customers in the customers table?*/
SELECT COUNT(customer_id) AS total_number_of_customers
FROM customers;

/*3. What is the average age of customers who can receive marketing emails (can_email is set to 'yes')?*/
SELECT ROUND(AVG(age)) AS average_age
FROM customers
WHERE can_email = 'yes';

/*4. How many orders were made by customers aged 30 or older?*/
SELECT COUNT(order_id) AS number_of_orders
FROM orders
JOIN customers
ON orders.customer_id = customers.customer_id
WHERE age >= 30;

/*5. What is the total revenue generated by each product category?*/
SELECT category, SUM(price) AS total_revenue
FROM products
GROUP BY category;

/*6. What is the average price of products in the 'food' category?*/
SELECT category, ROUND(AVG(price),2) AS average_price
FROM products
WHERE category = 'food';

/*7. How many orders were made in each sales channel (sales_channel column) in the orders table?*/
SELECT sales_channel, COUNT(order_id) AS number_of_orders
FROM orders
GROUP BY sales_channel;

/*8.What is the date of the latest order made by a customer who can receive marketing emails?*/
SELECT MAX(orders.date_shop) AS latest_date_order
FROM orders
JOIN customers
ON orders.customer_id = customers.customer_id
WHERE can_email = 'yes';

/*9. What is the name of the country with the highest number of orders?*/
SELECT country.country_name, COUNT(orders.order_id) AS highest_number_of_orders
FROM country
JOIN orders
ON country.country_id = orders.country_id
GROUP BY country.country_name
ORDER BY highest_number_of_orders DESC
LIMIT 1;

/*10. What is the average age of customers who made orders in the 'vitamins' product category?*/
SELECT ROUND(AVG(age)) AS average_age
FROM customers
JOIN orders ON customers.customer_id = orders.customer_id
JOIN baskets ON baskets.order_id = orders.order_id
JOIN products ON products.product_id = baskets.product_id
WHERE products.category = 'vitamins';
